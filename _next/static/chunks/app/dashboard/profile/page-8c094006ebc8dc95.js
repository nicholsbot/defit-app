(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{1244:(e,t,a)=>{Promise.resolve().then(a.bind(a,1489))},1489:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var r=a(5155),s=a(2115),i=a(6695),l=a(285),o=a(4237),n=a(157);let d=(0,n.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),c=(0,n.A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var u=a(7481),p=a(1966),h=a(5317),m=a(2360),f=a(1950),g=a(4202);function v(){var e;let{user:t}=(0,p.useUser)(),a=null;try{a=(0,p.useFirestore)()}catch(e){console.log("Firestore not available - running in demo mode")}let{toast:n}=(0,u.dj)(),{workoutLogs:v,userProfile:y}=(0,m.H)(),[x,_]=(0,s.useState)(""),[S,U]=(0,s.useState)(null),[M,j]=(0,s.useState)(null),[R,T]=(0,s.useState)(!1),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6;return new Promise((r,s)=>{let i=new window.Image,l=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(l);let e=document.createElement("canvas"),o=i.width,n=i.height;o>t&&(n=Math.round(n*t/o),o=t),e.width=o,e.height=n;let d=e.getContext("2d");if(!d)return void s(Error("Canvas not supported"));d.drawImage(i,0,0,o,n),r(e.toDataURL("image/jpeg",a))},i.onerror=()=>{URL.revokeObjectURL(l),s(Error("Failed to load image"))},i.src=l})};(0,s.useEffect)(()=>{y&&(_(y.displayName||""),U(y.avatarUrl||null))},[y]);let w=(0,s.useMemo)(()=>{if(!v||0===v.length)return 0;let e={};v.forEach(t=>{e[t.week]||(e[t.week]={tmar:0,strength:0,hiit:0,cardio:0}),e[t.week].tmar+=t.tmarMMinutes,e[t.week].strength+=t.resistanceLbs,e[t.week].hiit+=t.hiitMinutes;let a=t.cardioMilesRunning/f.u_.RUN_RUCK_WALK.goal+t.cardioMilesRucking/f.u_.RUN_RUCK_WALK.goal+t.cardioMilesWalking/f.u_.RUN_RUCK_WALK.goal+t.cardioMilesElliptical/f.u_.ELLIPTICAL_ROW.goal+t.cardioMilesRowing/f.u_.ELLIPTICAL_ROW.goal+t.cardioMetersSwimming/f.u_.SWIM.goal+t.cardioMilesCycling/f.u_.CYCLE.goal;e[t.week].cardio+=100*a});let t=Object.keys(e).length;if(0===t)return 0;let a=0,r=0,s=0,i=0;return Object.values(e).forEach(e=>{a+=e.tmar/f.Hk*100,r+=e.strength/f.Ct*100,s+=e.hiit/f.NU*100,i+=e.cardio}),(a/t+r/t+s/t+i/t)/4},[v]),E=async()=>{if(!t)return;if((0,g.HP)()||!a){(0,g.Z0)("Saving profile in demo mode (not persisted)"),n({title:"Demo Profile Updated",description:"Profile updated in demo mode (changes not saved)."});return}let e=(0,h.H9)(a,"users",t.uid);T(!0);let r=null;if(M)try{r=await k(M,256,.6);let e=Math.round(3*r.length/4/1024);if(e>500){n({variant:"destructive",title:"Image Too Large",description:"Compressed image is ~".concat(e,"KB. Please use a smaller photo. (Max ~500KB after compression)")}),T(!1);return}}catch(e){console.error("Image compression failed:",e),n({variant:"destructive",title:"Image Error",description:"Could not process the image. Please try a different file."}),T(!1);return}try{let t={displayName:x};r&&(t.avatarUrl=r),await (0,h.BN)(e,t,{merge:!0}),n({title:"Profile Updated",description:"Your profile has been successfully saved."})}catch(e){console.error("Profile update error:",e),n({variant:"destructive",title:"Update Failed",description:e.message||"Could not save your profile."})}finally{T(!1),M&&S&&S.startsWith("blob:")&&URL.revokeObjectURL(S),j(null)}},L=S||(null==t?void 0:t.photoURL),A=(null==x?void 0:x.charAt(0))||(null==t||null==(e=t.email)?void 0:e.charAt(0))||"U";return(0,r.jsx)("div",{className:"container mx-auto space-y-6",children:(0,r.jsxs)(i.Zp,{children:[(0,r.jsxs)(i.aR,{children:[(0,r.jsx)(i.ZB,{children:"Customize Profile"}),(0,r.jsx)(i.BT,{children:"Personalize your account details and profile picture."})]}),(0,r.jsx)(i.Wu,{className:"space-y-8",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,r.jsx)(o.p,{src:L||void 0,fallback:A,overallProgress:w,className:"h-32 w-32 border-4 border-primary text-4xl"}),(0,r.jsxs)("label",{htmlFor:"file-upload",className:"flex flex-col items-center gap-2 cursor-pointer text-muted-foreground hover:text-primary",children:[(0,r.jsx)(d,{className:"h-8 w-8"}),(0,r.jsx)("span",{className:"font-semibold",children:"Click to upload a photo"}),(0,r.jsx)("span",{className:"text-xs",children:"(PNG, JPG up to 5MB)"})]}),(0,r.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/png, image/jpeg",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];if(t.size>5242880)return void n({variant:"destructive",title:"File Too Large",description:"Please upload an image smaller than 5MB."});j(t),U(URL.createObjectURL(t))}}})]})}),(0,r.jsx)(i.wL,{children:(0,r.jsxs)(l.$,{onClick:E,disabled:R,children:[(0,r.jsx)(c,{className:"mr-2 h-4 w-4"}),R?"Saving...":"Save Changes"]})})]})})}},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>p});var r=a(2115);let s=0,i=new Map,l=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},n=[],d={toasts:[]};function c(e){d=o(d,e),n.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function p(){let[e,t]=r.useState(d);return r.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,277,698,970,196,239,955,749,834,181,441,684,358],()=>t(1244)),_N_E=e.O()}]);